var app=angular.module("app");app.controller("loginCtrl",["$scope","$location","$timeout","xhr",function(e,r,a,s){function t(r){e.errMsg=r,a.cancel(o),o=a(function(){e.errMsg=""},3e3)}var o=null;e.userName=H.Storage.get("userName")||"",e.password="",e.errMsg="",e.login=function(){return""==e.userName?void t("请输入用户名！"):""==e.password?void t("请输入密码！"):void s.ajax({method:"POST",url:"/user/login",data:{userName:e.userName,password:e.password}}).success(function(a){1==a.code&&null!=GetQueryString("staff_no")?s.ajax({method:"POST",url:"/user/addJobNumber",data:{userName:a.data[0].user_name,staff_no:GetQueryString("staff_no")}}).success(function(a){H.Storage.set("userName",e.userName),r.url("/platform/main")}).error(function(){H.alert("数据请求失败！")}):1==a.code&&null==GetQueryString("staff_no")?(H.Storage.set("userName",e.userName),r.url("/platform/main")):t(a.msg)}).error(function(){H.alert("数据请求失败！")})},e.xhrAjax=function(){s.ajax({method:"POST",url:"/user/seeJobNumber",data:{staff_no:GetQueryString("staff_no"),key:GetQueryString("key")}}).success(function(a){a.data.length>1&&$("#divBox").css("display","block"),e.dataMsg=a.data,e.oncc=function(){s.ajax({method:"POST",url:"/user/selectFun",data:{user_name:$(this)[0].$$watchers[2].last}}).success(function(e){H.Storage.set("userName",e.data[0].user_name),r.url("/platform/main")}).error(function(){H.alert("数据请求失败！")})},e.onHide=function(){$("#divBox").css("display","none")}}).error(function(){H.alert("数据请求失败！")})},null!=GetQueryString("staff_no")&&e.xhrAjax(),e.addJobNum=function(){return""==e.userName?void t("请输入用户名！"):""==e.password?void t("请输入密码！"):void s.ajax({method:"POST",url:"/user/login",data:{userName:e.userName,password:e.password}}).success(function(a){1==a.code?(H.Storage.set("userNameCha",e.userName),r.url("/addjobnum")):t(a.msg)}).error(function(){H.alert("数据请求失败！")})}}]);