var menuManageMod={popObj:null,init:function(){var e=this;e.getMenuList(),e.bindEvents()},getMenuList:function(){var e=this;$.ajax({type:"get",dataType:"json",url:"menu/list",beforeSend:function(){H.Loading.show()},success:function(n){1==n.code?e.createMenu(e.processData(n.data)):H.alert(n.msg)},error:function(){H.alert("获取用户菜单列表失败")},complete:function(){H.Loading.hide()}})},processData:function(e){var n=[],t=function(e,n,a){$.each(n,function(i,o){"undefined"==typeof o.submenu&&(o.submenu=[]),o.parent_id==e&&(a.push(o),t(o.id,n,o.submenu))})};return t(0,e,n),n},createMenu:function(e){var n=H.template($("#J-menu-tpl").html(),{items:e});$("#J-menu-wrap").html(n)},saveMenuMsg:function(e){var n=this;$.ajax({url:"/menu/save",method:"post",type:"json",timeout:1e4,data:e,beforeSend:function(){H.Loading.show()},success:function(e){1==e.code?(n.popObj.remove(),H.alert(e.msg,2e3,function(){n.getMenuList()})):H.alert(e.msg)},error:function(){H.alert("用户信息保存接口调用失败")},complete:function(){H.Loading.hide()}})},delMenu:function(e){var n=this;$.ajax({url:"/menu/del",method:"post",type:"json",timeout:1e4,data:{ids:e},beforeSend:function(){H.Loading.show()},success:function(e){1==e.code?H.alert(e.msg,2e3,function(){n.getMenuList()}):H.alert(e.msg)},error:function(){H.alert("用户删除接口调用失败")},complete:function(){H.Loading.hide()}})},bindEvents:function(){var e=this;$(document).on("mouseover","#J-menu-wrap .J-menu-item",function(){$(this).addClass("active")}).on("mouseleave","#J-menu-wrap .J-menu-item",function(){$(this).removeClass("active")}).on("change","#J-check-all",function(){var e=this.checked;$("#J-menu-wrap").find("input[type=checkbox]").each(function(){$(this).prop("checked",e)})}).on("change","#J-menu-wrap input[type=checkbox]",function(){$("#J-menu-wrap").find("input[type=checkbox]").length==$("#J-menu-wrap").find("input[type=checkbox]:checked").length?$("#J-check-all").prop("checked",!0):$("#J-check-all").prop("checked",!1)}).on("click","#J-add-btn, #J-menu-wrap a.J-add-btn, #J-menu-wrap a.J-edit-btn",function(n){n.preventDefault();var t=$(this);e.popObj=H.dialog({title:"add"==t.data("type")?"新增菜单":"修改菜单",content:$("#J-pop-tpl").html(),quickClose:!0,padding:10,backdropOpacity:.3,onshow:function(){if("edit"==t.data("type")){var e=$("#J-pop-form"),n=t.closest("p.J-menu-item");e.find("input[name=id]").val(t.data("id")),e.find("input[name=name]").val(n.find(".J-menu-name").text()),e.find("input[name=href]").val(n.find(".J-menu-href").text()),e.find("select[name=target]").val(t.data("target"))}else $("#J-pop-form").find("input[name=pid]").val(t.data("pid")||0)},onclose:function(){}}).show()}).on("submit","#J-pop-form",function(n){n.preventDefault(),e.saveMenuMsg($(this).serialize())}).on("click","#J-pop-cancel-btn",function(){e.popObj.remove()}).on("click","#J-menu-wrap a.J-del-btn",function(n){n.preventDefault();var t=$(this);H.confirm({content:"确定要删除此菜单？",quickClose:!0,width:300,okValue:"确定",backdropOpacity:.3,ok:function(){e.delMenu(t.data("id"))},cancelValue:"取消",cancel:function(){}}).show()}),$("#J-multi-del-btn").on("click",function(){var n=$("#J-menu-wrap").find("input[type=checkbox]:checked");if(0==n.length)H.alert("没有勾选任何菜单");else{var t=[],a=$("#J-menu-wrap").serializeArray();$.each(a,function(e,n){t.push(n.value)}),H.confirm({content:"确定要删除所有选中的菜单？",quickClose:!0,width:300,okValue:"确定",backdropOpacity:.3,ok:function(){e.delMenu(t.join(","))},cancelValue:"取消",cancel:function(){}}).show()}})}};$(function(){menuManageMod.init()});